<div id="sectorMisVentas">
  <div class="top-space">
    <a class="left-arrow" routerLink="/home">
      <i class="fa-sharp fa-solid fa-arrow-left" style="color: #000000;"></i>
    </a>
    <h2 class="pageTitle">Ventas Realizadas</h2>
  </div>
  
  <table id="tablaVentas">
    <thead>
      <tr>
        <th class="columnaCentral">ID</th>
        <th class="columnaImagen">Producto</th>
        <th class="columnaCentral">Cantidad</th>
        <th class="columnaCentral">Precio</th>
        <th class="columnaCentral">Total Venta</th>
        <th class="columnaCentral">Fecha</th>
        <th class="columnaCentral">Acciones</th>
      </tr>
    </thead>
    <tbody>
      @for (sale of sales; track sale.id) {
        <tr class="venta-row">
          <!-- ID de la venta -->
          <td>{{ sale.id }}</td>

          <!-- Celda fusionada: Producto + Cantidad + Precio -->
          <td [attr.colspan]="3">
            <div class="productosVenta">
              <div class="productosVenta__header">
              </div>

              @for (detail of sale.saleDetail; track detail.product.id) {
                <div class="productoDetalle">
                  <div class="productoDetalle__info">
                    <img
                      loading="lazy"
                      [src]="detail.product.images?.[0]?.url"
                      alt="{{ detail.product.name }}"
                      class="imgProducto"
                    />
                    <span>{{ detail.product.name }}</span>
                  </div>
                  <div class="productoDetalle__qty">
                    {{ detail.quantity }}
                  </div>
                  <div class="productoDetalle__price">
                    {{ '$' + detail.product.price }}
                  </div>
                </div>
              }
            </div>
          </td>

          <!-- Total de la venta -->
          <td>{{ '$' + sale.total }}</td>

          <!-- Fecha -->
          <td><p>{{ sale.saleDate | date: 'dd/MM/yyyy' }}</p></td>

          <!-- Acciones -->
          <td class="acciones">
            <a class="btnVerDetalle" (click)="openModal(sale.customer)" title="Ver detalle">
              <i class="fas fa-eye"></i>
            </a>
            <a class="btnEliminar" href="#" title="Eliminar">
              <i class="fas fa-trash"></i>
            </a>
          </td>
        </tr>
      }
    </tbody>
  </table>

  <!-- Modal -->
<div
  *ngIf="isModalOpen"
  class="modal-overlay"
  (click)="closeModal()"
>
  <div
    class="modal-box"
    (click)="$event.stopPropagation()"
  >
    <button
      class="modal-close"
      aria-label="Cerrar"
      (click)="closeModal()"
    >
      &times;
    </button>

    <div class="modal-body">
      <p><strong>Nombre:</strong> {{ customer?.firstName }}</p>
      <p><strong>Apellido:</strong> {{ customer?.lastName }}</p>
      <p><strong>Email:</strong> {{ customer?.email }}</p>
      <p><strong>Teléfono:</strong> {{ customer?.phone }}</p>
      <p><strong>Fecha de Registro:</strong> {{ customer?.registrationDate | date:'dd/MM/yyyy' }}</p>
      <!-- Agrega aquí los campos que necesites -->
    </div>
  </div>
</div>

  <div class="pagination">
    <button (click)="prevPage()" [disabled]="page === 1">
      ‹ Anterior
    </button>

    <div class="page-info">
      Página {{ page }} de {{ totalPages }}
    </div>

    <button (click)="nextPage()" [disabled]="page === totalPages">
      Siguiente ›
    </button>
  </div>
</div>
